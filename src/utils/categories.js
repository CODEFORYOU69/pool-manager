export const KYORUGI_CATEGORIES = {
  MALE: {
    BABY: [
      { name: "-16kg", pss: "# 0", hitLevel: 5 },
      { name: "-18kg", pss: "# 0", hitLevel: 5 },
      { name: "-20kg", pss: "# 0", hitLevel: 6 },
      { name: "-22kg", pss: "# 0", hitLevel: 6 },
      { name: "-24kg", pss: "# 0", hitLevel: 6 },
      { name: "-26kg", pss: "# 0", hitLevel: 7 },
      { name: "+26kg", pss: "# 0", hitLevel: 7 },
    ],
    PUPILLE: [
      { name: "-20kg", pss: "# 0", hitLevel: 6 },
      { name: "-22kg", pss: "# 0", hitLevel: 6 },
      { name: "-24kg", pss: "# 0", hitLevel: 7 },
      { name: "-26kg", pss: "# 0", hitLevel: 7 },
      { name: "-28kg", pss: "# 0", hitLevel: 7 },
      { name: "-30kg", pss: "# 0", hitLevel: 8 },
      { name: "-32kg", pss: "# 0", hitLevel: 8 },
      { name: "-34kg", pss: "# 0", hitLevel: 8 },
      { name: "-37kg", pss: "# 1", hitLevel: 9 },
      { name: "+37kg", pss: "# 1", hitLevel: 9 },
    ],
    BENJAMIN: [
      { name: "-24kg", pss: "# 0", hitLevel: 7 },
      { name: "-26kg", pss: "# 0", hitLevel: 7 },
      { name: "-28kg", pss: "# 0", hitLevel: 8 },
      { name: "-30kg", pss: "# 0", hitLevel: 8 },
      { name: "-32kg", pss: "# 0", hitLevel: 9 },
      { name: "-34kg", pss: "# 0", hitLevel: 9 },
      { name: "-37kg", pss: "# 1", hitLevel: 9 },
      { name: "-40kg", pss: "# 1", hitLevel: 10 },
      { name: "-43kg", pss: "# 1", hitLevel: 11 },
      { name: "+43kg", pss: "# 2", hitLevel: 13 },
    ],
    MINIME: [
      { name: "-27kg", pss: "# 0", hitLevel: 9 },
      { name: "-30kg", pss: "# 0", hitLevel: 10 },
      { name: "-33kg", pss: "# 0", hitLevel: 11 },
      { name: "-37kg", pss: "# 1", hitLevel: 12 },
      { name: "-41kg", pss: "# 1", hitLevel: 13 },
      { name: "-45kg", pss: "# 1", hitLevel: 14 },
      { name: "-49kg", pss: "# 2", hitLevel: 15 },
      { name: "-53kg", pss: "# 2", hitLevel: 16 },
      { name: "-57kg", pss: "# 3", hitLevel: 17 },
      { name: "+57kg", pss: "# 3", hitLevel: 18 },
    ],
    CADET: [
      { name: "-33kg", pss: "# 0", hitLevel: 10 },
      { name: "-37kg", pss: "# 0", hitLevel: 11 },
      { name: "-41kg", pss: "# 1", hitLevel: 13 },
      { name: "-45kg", pss: "# 1", hitLevel: 14 },
      { name: "-49kg", pss: "# 1", hitLevel: 15 },
      { name: "-53kg", pss: "# 2", hitLevel: 16 },
      { name: "-57kg", pss: "# 2", hitLevel: 17 },
      { name: "-61kg", pss: "# 2", hitLevel: 18 },
      { name: "-65kg", pss: "# 3", hitLevel: 19 },
      { name: "+65kg", pss: "# 3", hitLevel: 20 },
    ],
    JUNIOR: [
      { name: "-45kg", pss: "# 1", hitLevel: 17 },
      { name: "-48kg", pss: "# 2", hitLevel: 18 },
      { name: "-51kg", pss: "# 2", hitLevel: 19 },
      { name: "-55kg", pss: "# 2", hitLevel: 20 },
      { name: "-59kg", pss: "# 3", hitLevel: 21 },
      { name: "-63kg", pss: "# 3", hitLevel: 22 },
      { name: "-68kg", pss: "# 3", hitLevel: 23 },
      { name: "-73kg", pss: "# 4", hitLevel: 24 },
      { name: "-78kg", pss: "# 4", hitLevel: 25 },
      { name: "+78kg", pss: "# 4", hitLevel: 26 },
    ],
    ESPOIR: [
      { name: "-54kg", pss: "# 2", hitLevel: 20 },
      { name: "-58kg", pss: "# 2", hitLevel: 21 },
      { name: "-63kg", pss: "# 3", hitLevel: 22 },
      { name: "-68kg", pss: "# 3", hitLevel: 23 },
      { name: "-74kg", pss: "# 3", hitLevel: 24 },
      { name: "-80kg", pss: "# 4", hitLevel: 25 },
      { name: "-87kg", pss: "# 4", hitLevel: 26 },
      { name: "+87kg", pss: "# 4/5", hitLevel: 27 },
    ],
    SENIOR: [
      { name: "-54kg", pss: "# 2", hitLevel: 21 },
      { name: "-58kg", pss: "# 2", hitLevel: 22 },
      { name: "-63kg", pss: "# 3", hitLevel: 23 },
      { name: "-68kg", pss: "# 3", hitLevel: 24 },
      { name: "-74kg", pss: "# 3", hitLevel: 25 },
      { name: "-80kg", pss: "# 4", hitLevel: 26 },
      { name: "-87kg", pss: "# 4", hitLevel: 27 },
      { name: "+87kg", pss: "# 4/5", hitLevel: 28 },
    ],
    MASTER: [
      { name: "-58kg", pss: "# 2", hitLevel: 19 },
      { name: "-68kg", pss: "# 3", hitLevel: 20 },
      { name: "-80kg", pss: "# 4", hitLevel: 21 },
      { name: "+80kg", pss: "# 4", hitLevel: 22 },
    ],
  },
  FEMALE: {
    BABY: [
      { name: "-15kg", pss: "# 0", hitLevel: 4 },
      { name: "-17kg", pss: "# 0", hitLevel: 4 },
      { name: "-19kg", pss: "# 0", hitLevel: 5 },
      { name: "-21kg", pss: "# 0", hitLevel: 5 },
      { name: "-23kg", pss: "# 0", hitLevel: 5 },
      { name: "-25kg", pss: "# 0", hitLevel: 6 },
      { name: "+25kg", pss: "# 0", hitLevel: 6 },
    ],
    PUPILLE: [
      { name: "-19kg", pss: "# 0", hitLevel: 5 },
      { name: "-21kg", pss: "# 0", hitLevel: 5 },
      { name: "-23kg", pss: "# 0", hitLevel: 6 },
      { name: "-25kg", pss: "# 0", hitLevel: 6 },
      { name: "-27kg", pss: "# 0", hitLevel: 6 },
      { name: "-29kg", pss: "# 0", hitLevel: 7 },
      { name: "-31kg", pss: "# 0", hitLevel: 7 },
      { name: "-33kg", pss: "# 0", hitLevel: 7 },
      { name: "-36kg", pss: "# 1", hitLevel: 8 },
      { name: "+36kg", pss: "# 1", hitLevel: 8 },
    ],
    BENJAMIN: [
      { name: "-23kg", pss: "# 0", hitLevel: 6 },
      { name: "-25kg", pss: "# 0", hitLevel: 6 },
      { name: "-27kg", pss: "# 0", hitLevel: 7 },
      { name: "-29kg", pss: "# 0", hitLevel: 7 },
      { name: "-31kg", pss: "# 0", hitLevel: 8 },
      { name: "-33kg", pss: "# 0", hitLevel: 8 },
      { name: "-36kg", pss: "# 1", hitLevel: 9 },
      { name: "-39kg", pss: "# 1", hitLevel: 10 },
      { name: "-42kg", pss: "# 1", hitLevel: 11 },
      { name: "+42kg", pss: "# 2", hitLevel: 12 },
    ],
    MINIME: [
      { name: "-23kg", pss: "# 0", hitLevel: 7 },
      { name: "-26kg", pss: "# 0", hitLevel: 8 },
      { name: "-29kg", pss: "# 0", hitLevel: 8 },
      { name: "-33kg", pss: "# 0", hitLevel: 9 },
      { name: "-37kg", pss: "# 1", hitLevel: 10 },
      { name: "-41kg", pss: "# 1", hitLevel: 11 },
      { name: "-44kg", pss: "# 1", hitLevel: 12 },
      { name: "-47kg", pss: "# 2", hitLevel: 13 },
      { name: "-51kg", pss: "# 3", hitLevel: 14 },
      { name: "+51kg", pss: "# 3", hitLevel: 15 },
    ],
    CADET: [
      { name: "-29kg", pss: "# 0", hitLevel: 10 },
      { name: "-33kg", pss: "# 0", hitLevel: 11 },
      { name: "-37kg", pss: "# 1", hitLevel: 13 },
      { name: "-41kg", pss: "# 1", hitLevel: 14 },
      { name: "-44kg", pss: "# 1", hitLevel: 15 },
      { name: "-47kg", pss: "# 2", hitLevel: 16 },
      { name: "-51kg", pss: "# 2", hitLevel: 17 },
      { name: "-55kg", pss: "# 2", hitLevel: 18 },
      { name: "-59kg", pss: "# 3", hitLevel: 19 },
      { name: "+59kg", pss: "# 3", hitLevel: 20 },
    ],
    JUNIOR: [
      { name: "-42kg", pss: "# 1", hitLevel: 14 },
      { name: "-44kg", pss: "# 1", hitLevel: 15 },
      { name: "-46kg", pss: "# 1", hitLevel: 16 },
      { name: "-49kg", pss: "# 2", hitLevel: 17 },
      { name: "-52kg", pss: "# 2", hitLevel: 18 },
      { name: "-55kg", pss: "# 2", hitLevel: 19 },
      { name: "-59kg", pss: "# 3", hitLevel: 20 },
      { name: "-63kg", pss: "# 3", hitLevel: 21 },
      { name: "-68kg", pss: "# 3", hitLevel: 22 },
      { name: "+68kg", pss: "# 4", hitLevel: 23 },
    ],
    ESPOIR: [
      { name: "-46kg", pss: "# 2", hitLevel: 16 },
      { name: "-49kg", pss: "# 2", hitLevel: 17 },
      { name: "-53kg", pss: "# 2", hitLevel: 18 },
      { name: "-57kg", pss: "# 3", hitLevel: 19 },
      { name: "-62kg", pss: "# 3", hitLevel: 20 },
      { name: "-67kg", pss: "# 4", hitLevel: 21 },
      { name: "-73kg", pss: "# 4", hitLevel: 22 },
      { name: "+73kg", pss: "# 4", hitLevel: 23 },
    ],
    SENIOR: [
      { name: "-46kg", pss: "# 2", hitLevel: 17 },
      { name: "-49kg", pss: "# 2", hitLevel: 18 },
      { name: "-53kg", pss: "# 2", hitLevel: 19 },
      { name: "-57kg", pss: "# 2", hitLevel: 20 },
      { name: "-62kg", pss: "# 3", hitLevel: 21 },
      { name: "-67kg", pss: "# 3", hitLevel: 22 },
      { name: "-73kg", pss: "# 4", hitLevel: 23 },
      { name: "+73kg", pss: "# 4", hitLevel: 24 },
    ],
    MASTER: [
      { name: "-49kg", pss: "# 2", hitLevel: 17 },
      { name: "-57kg", pss: "# 2", hitLevel: 18 },
      { name: "-67kg", pss: "# 3", hitLevel: 19 },
      { name: "+67kg", pss: "# 3", hitLevel: 20 },
    ],
  },
};

export const OLYMPIC_CATEGORIES = {
  MALE: {
    JUNIOR: [
      { name: "-48kg", pss: "# 2", hitLevel: 18 },
      { name: "-55kg", pss: "# 2", hitLevel: 20 },
      { name: "-63kg", pss: "# 3", hitLevel: 22 },
      { name: "-73kg", pss: "# 4", hitLevel: 24 },
      { name: "+73kg", pss: "# 4", hitLevel: 26 },
    ],
    SENIOR: [
      { name: "-58kg", pss: "# 3", hitLevel: 22 },
      { name: "-68kg", pss: "# 3", hitLevel: 24 },
      { name: "-80kg", pss: "# 4", hitLevel: 26 },
      { name: "+80kg", pss: "# 5", hitLevel: 28 },
    ],
  },
  FEMALE: {
    JUNIOR: [
      { name: "-44kg", pss: "# 1", hitLevel: 15 },
      { name: "-49kg", pss: "# 2", hitLevel: 17 },
      { name: "-55kg", pss: "# 2", hitLevel: 19 },
      { name: "-63kg", pss: "# 3", hitLevel: 21 },
      { name: "+63kg", pss: "# 3", hitLevel: 23 },
    ],
    SENIOR: [
      { name: "-49kg", pss: "# 2", hitLevel: 18 },
      { name: "-57kg", pss: "# 2", hitLevel: 20 },
      { name: "-67kg", pss: "# 3", hitLevel: 22 },
      { name: "+67kg", pss: "# 3", hitLevel: 24 },
    ],
  },
};

export const PARA_CATEGORIES = {
  MALE: {
    K44_K41: [
      { name: "-58kg", pss: "# 2", hitLevel: 20 },
      { name: "-63kg", pss: "# 3", hitLevel: 21 },
      { name: "-70kg", pss: "# 3", hitLevel: 22 },
      { name: "-80kg", pss: "# 4", hitLevel: 23 },
      { name: "+80kg", pss: "# 4", hitLevel: 24 },
    ],
  },
  FEMALE: {
    K44_K41: [
      { name: "-47kg", pss: "# 2", hitLevel: 16 },
      { name: "-52kg", pss: "# 2", hitLevel: 17 },
      { name: "-57kg", pss: "# 2", hitLevel: 18 },
      { name: "+57kg", pss: "# 3", hitLevel: 19 },
    ],
  },
};

export const AGE_CATEGORIES = {
  BABY: {
    name: "Baby",
    years: true,
  },
  PUPILLE: {
    name: "Pupille",
    years: true,
  },
  BENJAMIN: {
    name: "Benjamin",
    years: true,
  },
  MINIME: {
    name: "Minime",
    years: false,
  },
  CADET: {
    name: "Cadet",
    years: false,
  },
  JUNIOR: {
    name: "Junior",
    years: false,
  },
  ESPOIR: {
    name: "Espoir",
    years: false,
  },
  SENIOR: {
    name: "Senior",
    years: false,
  },
  MASTER: {
    name: "Master",
    years: false,
  },
};

// Fonction utilitaire pour normaliser les noms de catégories
export const normalizeCategory = (category) => {
  if (!category) return "";

  // Convertir en chaîne de caractères
  const categoryStr = String(category);

  // Supprimer les espaces, mettre en majuscules et supprimer les accents
  return categoryStr
    .trim()
    .toUpperCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, ""); // Supprimer les diacritiques (accents, etc.)
};

// Fonction pour extraire le poids d'une catégorie de poids
export const extractWeight = (weightCategory) => {
  // S'il s'agit d'un objet avec une propriété 'name'
  const weightStr =
    typeof weightCategory === "object" && weightCategory.name
      ? weightCategory.name
      : weightCategory;

  // Extraire le nombre du poids (ex: "-58kg" -> 58, "+87kg" -> 87)
  const match = weightStr.match(/([+-])(\d+)kg/);
  if (!match) return null;

  const isPlus = match[1] === "+";
  const weight = parseInt(match[2], 10);

  // Pour une catégorie avec +, nous retournons le poids + 0.1 pour qu'il soit supérieur à la limite exacte
  return isPlus ? weight + 0.1 : weight;
};

// Fonction utilitaire pour trouver les informations PSS pour une catégorie d'âge, un genre et un poids
export const findPssInfo = (ageCategory, gender, weightCategory) => {
  try {
    console.log("findPssInfo appelée avec:", {
      ageCategory,
      gender,
      weightCategory,
    });

    if (!ageCategory || !gender || !weightCategory) {
      console.log("Paramètres manquants pour findPssInfo");
      return null;
    }

    // Tableau de correspondance pour les noms de catégories d'âge normalisés
    const ageCategoryMapping = {
      baby: "BABY",
      babys: "BABY",
      pupille: "PUPILLE",
      pupilles: "PUPILLE",
      benjamin: "BENJAMIN",
      benjamins: "BENJAMIN",
      benjamine: "BENJAMIN",
      benjamines: "BENJAMIN",
      minime: "MINIME",
      minimes: "MINIME",
      cadet: "CADET",
      cadets: "CADET",
      cadette: "CADET",
      cadettes: "CADET",
      junior: "JUNIOR",
      juniors: "JUNIOR",
      espoir: "ESPOIR",
      espoirs: "ESPOIR",
      senior: "SENIOR",
      seniors: "SENIOR",
      master: "MASTER",
      masters: "MASTER",
      veteran: "MASTER",
      veterans: "MASTER",
    };

    // Normaliser la catégorie d'âge
    const normalizedAgeCategory = normalizeCategory(ageCategory);

    // Essayer de trouver la clé directement via le mapping
    let ageCatKey = ageCategoryMapping[normalizedAgeCategory];

    // Si pas trouvé dans le mapping, essayer de manière standard
    if (!ageCatKey) {
      ageCatKey = Object.keys(AGE_CATEGORIES).find(
        (key) =>
          normalizeCategory(AGE_CATEGORIES[key].name) === normalizedAgeCategory
      );
    }

    console.log("Clé de catégorie d'âge trouvée:", ageCatKey);

    if (!ageCatKey) return null;

    // Normaliser le genre
    const genderNormalized = gender.toString().trim().toUpperCase();
    const genderKey =
      genderNormalized === "FEMALE" || genderNormalized === "F"
        ? "FEMALE"
        : "MALE";

    // Obtenir la liste des catégories de poids
    const weightCategories = KYORUGI_CATEGORIES[genderKey][ageCatKey];
    console.log("Catégories de poids disponibles:", weightCategories);

    if (!weightCategories) {
      console.log("Aucune catégorie de poids trouvée pour cette combinaison");
      return null;
    }

    // Extraire le nom de la catégorie de poids de différentes manières possibles
    let weightName;

    if (typeof weightCategory === "string") {
      // Si c'est déjà une chaîne simple
      weightName = weightCategory;
    } else if (typeof weightCategory === "object") {
      // Si c'est un objet, essayer différentes propriétés
      if (weightCategory.name) {
        weightName = weightCategory.name;
      } else if (weightCategory.weightCategoryName) {
        weightName = weightCategory.weightCategoryName;
      } else if (weightCategory.value) {
        weightName = weightCategory.value;
      }
    }

    console.log("Nom de catégorie de poids extrait:", weightName);

    // Si aucun nom n'a pu être extrait, quitter
    if (!weightName) {
      console.log("Impossible d'extraire un nom de catégorie de poids");
      return null;
    }

    // Nettoyer les espaces et normaliser
    weightName = weightName.toString().trim();

    // Trouver la catégorie de poids correspondante
    const matchingWeightCat = weightCategories.find((wc) => {
      // Extraire le nom selon le type
      const wcName = typeof wc === "object" ? wc.name : wc;

      // Comparer les noms de catégorie
      if (wcName === weightName) {
        return true;
      }

      // Normaliser pour la comparaison
      const cleanedName = weightName.replace(/\s+/g, "").toLowerCase();
      const cleanedWcName = wcName.replace(/\s+/g, "").toLowerCase();

      // Comparaison sensible aux signes + et -
      if (cleanedName === cleanedWcName) {
        return true;
      }

      // Comparaison en ignorant "kg" à la fin
      const nameWithoutUnit = cleanedName.replace(/kg$/, "");
      const wcNameWithoutUnit = cleanedWcName.replace(/kg$/, "");

      return nameWithoutUnit === wcNameWithoutUnit;
    });

    console.log(
      "Catégorie de poids correspondante trouvée:",
      matchingWeightCat
    );

    if (!matchingWeightCat) return null;

    // Si c'est déjà un objet avec pss et hitLevel, le retourner directement
    if (
      typeof matchingWeightCat === "object" &&
      matchingWeightCat.pss &&
      matchingWeightCat.hitLevel
    ) {
      console.log("Informations PSS trouvées:", {
        pss: matchingWeightCat.pss,
        hitLevel: matchingWeightCat.hitLevel,
      });
      return {
        pss: matchingWeightCat.pss,
        hitLevel: matchingWeightCat.hitLevel,
      };
    }

    // Sinon, retourner null car nous n'avons pas d'informations PSS pour cette catégorie
    console.log("Aucune information PSS trouvée");
    return null;
  } catch (error) {
    console.error("Erreur lors de la recherche des informations PSS:", error);
    return null;
  }
};
